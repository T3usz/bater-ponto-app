import{a as Y,b as Z,c as tt,d as ot}from"./chunk-W4MQIXV3.js";import{a as et}from"./chunk-SJ73BFP3.js";import{b as O,c as k,d as D,e as H,f as G,g as B,i as L,j as U,k as j,l as $,m as N,n as q,o as V,q as W,r as J,s as K,u as Q}from"./chunk-32JNCDV7.js";import{b as X}from"./chunk-62KKBQKF.js";import"./chunk-OPOPYXTZ.js";import"./chunk-QUJFQN2Y.js";import"./chunk-YOZNQCKQ.js";import"./chunk-TO3YK3EL.js";import"./chunk-TFRGKSYX.js";import"./chunk-5PZWBJ5K.js";import"./chunk-QGWWHAGH.js";import"./chunk-SS7TARZG.js";import"./chunk-M66VC23L.js";import"./chunk-C53WGXWK.js";import"./chunk-EY55SHVB.js";import"./chunk-LBMIQEU6.js";import"./chunk-WI5MSH4N.js";import"./chunk-WMQ3YVF2.js";import"./chunk-CKP3SGE2.js";import"./chunk-ZWD2LTBS.js";import{B as l,C as E,D as a,E as i,F as m,K as I,L as S,T as n,U as b,Ua as A,V as g,Y as u,_ as h,fa as F,ia as M,ja as z,la as T,q as C,r,s as w,u as R,y as v}from"./chunk-2R7TGF7V.js";import"./chunk-KGSAT2V3.js";import"./chunk-6E6KLUTW.js";import"./chunk-7SAK7W3C.js";import"./chunk-6N6ZTUD2.js";import"./chunk-Z3EESIK6.js";import"./chunk-FXFZIWDD.js";import"./chunk-ZD3NZWAU.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{h as d}from"./chunk-LNJ3S2LQ.js";function at(e){e.CapacitorUtils.Synapse=new Proxy({},{get(s,p){return new Proxy({},{get(t,c){return(o,f,P)=>{let y=e.Capacitor.Plugins[p];if(y===void 0){P(new Error(`Capacitor plugin ${p} not found`));return}if(typeof y[c]!="function"){P(new Error(`Method ${c} not found in Capacitor plugin ${p}`));return}d(null,null,function*(){try{let _=yield y[c](o);f(_)}catch(_){P(_)}})}}})}})}function nt(e){e.CapacitorUtils.Synapse=new Proxy({},{get(s,p){return e.cordova.plugins[p]}})}function it(e=!1){window.CapacitorUtils=window.CapacitorUtils||{},window.Capacitor!==void 0&&!e?at(window):window.cordova!==void 0&&nt(window)}var x=X("Geolocation",{web:()=>import("./chunk-ZNBBJWTJ.js").then(e=>new e.GeolocationWeb)});it();function rt(e,s){if(e&1&&(a(0,"div",18)(1,"p")(2,"strong"),n(3,"Latitude:"),i(),n(4),u(5,"number"),i(),a(6,"p")(7,"strong"),n(8,"Longitude:"),i(),n(9),u(10,"number"),i(),a(11,"p")(12,"strong"),n(13,"Precis\xE3o:"),i(),n(14),u(15,"number"),i()()),e&2){let p=S();r(4),g(" ",h(5,3,p.localizacao.latitude,"1.6-6"),""),r(5),g(" ",h(10,6,p.localizacao.longitude,"1.6-6"),""),r(5),g(" ",h(15,9,p.localizacao.precisao,"1.0-0"),"m")}}function ct(e,s){e&1&&(a(0,"div",19),m(1,"ion-icon",20),a(2,"p"),n(3,"Nenhuma foto capturada"),i()())}function st(e,s){if(e&1&&m(0,"img",21),e&2){let p=S();l("src",p.foto,C)}}function lt(e,s){e&1&&(a(0,"span"),n(1,"Registrar Ponto"),i())}function pt(e,s){e&1&&(a(0,"span"),n(1,"Registrando..."),i())}var Rt=(()=>{let s=class s{constructor(t,c){this.offlineStorage=t,this.faceRecognition=c,this.gpsAtivo=!1,this.carregando=!1,this.dataHoraAtual=new Date,this.reconhecimentoFacial=!1,this.tipoRegistro="entrada"}ngOnInit(){this.verificarGPS(),this.atualizarDataHora(),this.determinarTipoRegistro()}atualizarDataHora(){setInterval(()=>{this.dataHoraAtual=new Date},1e3)}determinarTipoRegistro(){let t=this.offlineStorage.obterRegistrosPonto(),c=new Date().toDateString();switch(t.filter(f=>new Date(f.dataHora).toDateString()===c).length){case 0:this.tipoRegistro="entrada";break;case 1:this.tipoRegistro="saida_almoco";break;case 2:this.tipoRegistro="volta_almoco";break;default:this.tipoRegistro="saida";break}}verificarGPS(){return d(this,null,function*(){try{if((yield x.checkPermissions()).location==="granted")this.gpsAtivo=!0,yield this.obterLocalizacao();else{let c=yield x.requestPermissions();this.gpsAtivo=c.location==="granted",this.gpsAtivo&&(yield this.obterLocalizacao())}}catch(t){console.error("Erro ao verificar GPS:",t),this.gpsAtivo=!1}})}obterLocalizacao(){return d(this,null,function*(){try{let t=yield x.getCurrentPosition();this.localizacao={latitude:t.coords.latitude,longitude:t.coords.longitude,precisao:t.coords.accuracy}}catch(t){console.error("Erro ao obter localiza\xE7\xE3o:",t)}})}capturarFoto(){return d(this,null,function*(){try{let t=yield tt.getPhoto({quality:90,allowEditing:!1,resultType:Z.DataUrl,source:Y.Camera});this.foto=t.dataUrl,yield this.verificarReconhecimentoFacial()}catch(t){console.error("Erro ao capturar foto:",t)}})}verificarReconhecimentoFacial(){return d(this,null,function*(){if(this.foto)try{let t=this.faceRecognition.getFaceDescriptor("user_12345");if(t){let c=yield this.faceRecognition.extractFaceDescriptor(this.foto);if(c){let o=yield this.faceRecognition.compareFaces(t,c);this.reconhecimentoFacial=this.faceRecognition.isMatch(o)}}}catch(t){console.error("Erro no reconhecimento facial:",t),this.reconhecimentoFacial=!1}})}registrarPonto(){return d(this,null,function*(){if(!this.foto){alert("\xC9 necess\xE1rio capturar uma foto para registrar o ponto.");return}if(!this.gpsAtivo||!this.localizacao){alert("\xC9 necess\xE1rio ativar o GPS para registrar o ponto.");return}this.carregando=!0;try{let t={dataHora:new Date().toISOString(),tipo:this.tipoRegistro,foto:this.foto,localizacao:this.localizacao},c=this.offlineStorage.salvarRegistroPonto(t);alert(`Ponto registrado com sucesso! ${this.reconhecimentoFacial?"(Reconhecimento facial confirmado)":""}`),this.limparFormulario(),this.determinarTipoRegistro()}catch(t){console.error("Erro ao registrar ponto:",t),alert("Erro ao registrar ponto. Tente novamente.")}finally{this.carregando=!1}})}limparFormulario(){this.foto=void 0,this.reconhecimentoFacial=!1}getTipoRegistroTexto(){return{entrada:"Entrada",saida_almoco:"Sa\xEDda para Almo\xE7o",volta_almoco:"Volta do Almo\xE7o",saida:"Sa\xEDda"}[this.tipoRegistro]}};s.\u0275fac=function(c){return new(c||s)(w(et),w(ot))},s.\u0275cmp=R({type:s,selectors:[["app-registrar-ponto"]],decls:52,vars:21,consts:[[3,"translucent"],["slot","start"],["defaultHref","/tabs/home"],[3,"fullscreen"],[1,"container"],[1,"status-gps"],[3,"name","color"],["class","localizacao-info",4,"ngIf"],[1,"foto-container"],["class","foto-placeholder",4,"ngIf"],["alt","Foto capturada","class","foto-preview",3,"src",4,"ngIf"],["expand","block","fill","outline",3,"click"],["name","camera","slot","start"],["slot","end",3,"color"],[1,"registro-button"],["expand","block","color","primary","size","large",3,"click","disabled"],["name","time","slot","start"],[4,"ngIf"],[1,"localizacao-info"],[1,"foto-placeholder"],["name","camera","size","large"],["alt","Foto capturada",1,"foto-preview",3,"src"]],template:function(c,o){c&1&&(a(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),m(3,"ion-back-button",2),i(),a(4,"ion-title"),n(5,"Registrar Ponto"),i()()(),a(6,"ion-content",3)(7,"div",4)(8,"ion-card")(9,"ion-card-content")(10,"div",5),m(11,"ion-icon",6),a(12,"span"),n(13),i()(),v(14,rt,16,12,"div",7),i()(),a(15,"ion-card")(16,"ion-card-header")(17,"ion-card-title"),n(18,"Foto para Reconhecimento"),i()(),a(19,"ion-card-content")(20,"div",8),v(21,ct,4,0,"div",9)(22,st,1,1,"img",10),i(),a(23,"ion-button",11),I("click",function(){return o.capturarFoto()}),m(24,"ion-icon",12),n(25),i()()(),a(26,"ion-card")(27,"ion-card-header")(28,"ion-card-title"),n(29,"Informa\xE7\xF5es do Registro"),i()(),a(30,"ion-card-content")(31,"ion-list")(32,"ion-item")(33,"ion-label")(34,"h3"),n(35,"Data e Hora"),i(),a(36,"p"),n(37),u(38,"date"),i()()(),a(39,"ion-item")(40,"ion-label")(41,"h3"),n(42,"Tipo de Registro"),i(),a(43,"p"),n(44),i()(),a(45,"ion-badge",13),n(46),i()()()()(),a(47,"div",14)(48,"ion-button",15),I("click",function(){return o.registrarPonto()}),m(49,"ion-icon",16),v(50,lt,2,0,"span",17)(51,pt,2,0,"span",17),i()()()()),c&2&&(l("translucent",!0),r(6),l("fullscreen",!0),r(5),l("name",o.gpsAtivo?"location":"location-outline")("color",o.gpsAtivo?"success":"danger"),r(),E(o.gpsAtivo?"text-success":"text-danger"),r(),g(" ",o.gpsAtivo?"GPS Ativo":"GPS Inativo"," "),r(),l("ngIf",o.localizacao),r(7),l("ngIf",!o.foto),r(),l("ngIf",o.foto),r(3),g(" ",o.foto?"Capturar Nova Foto":"Capturar Foto"," "),r(12),b(h(38,18,o.dataHoraAtual,"dd/MM/yyyy HH:mm:ss")),r(7),b(o.getTipoRegistroTexto()),r(),l("color",o.reconhecimentoFacial?"success":"medium"),r(),g(" ",o.reconhecimentoFacial?"Rosto Reconhecido":"Aguardando Foto"," "),r(2),l("disabled",o.carregando||!o.foto||!o.gpsAtivo),r(2),l("ngIf",!o.carregando),r(),l("ngIf",o.carregando))},dependencies:[Q,O,k,D,H,G,B,L,U,j,$,N,q,V,W,J,K,T,F,z,M,A],styles:[".container[_ngcontent-%COMP%]{padding:16px}.status-gps[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:16px}.status-gps[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:24px}.text-success[_ngcontent-%COMP%]{color:var(--ion-color-success);font-weight:500}.text-danger[_ngcontent-%COMP%]{color:var(--ion-color-danger);font-weight:500}.localizacao-info[_ngcontent-%COMP%]{background:var(--ion-color-light);padding:12px;border-radius:8px;margin-top:12px}.localizacao-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:4px 0;font-size:14px}.foto-container[_ngcontent-%COMP%]{text-align:center;margin-bottom:16px}.foto-placeholder[_ngcontent-%COMP%]{padding:40px;background:var(--ion-color-light);border-radius:8px;color:var(--ion-color-medium)}.foto-placeholder[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-bottom:8px}.foto-preview[_ngcontent-%COMP%]{max-width:100%;max-height:300px;border-radius:8px;box-shadow:0 2px 8px #0000001a}.registro-button[_ngcontent-%COMP%]{margin-top:24px;padding:0 16px 16px}"]});let e=s;return e})();export{Rt as RegistrarPontoPage};
