import{d as S}from"./chunk-2R7TGF7V.js";import{a as e,b as c,h as n}from"./chunk-LNJ3S2LQ.js";var l=(()=>{let r=class r{constructor(){this.STORAGE_KEYS={REGISTROS_PONTO:"registros_ponto",CONFIGURACOES:"app_configuracoes",USUARIO:"usuario_dados",SINCRONIZACAO:"sincronizacao_status"},this.inicializarArmazenamento()}inicializarArmazenamento(){if(localStorage.getItem(this.STORAGE_KEYS.REGISTROS_PONTO)||localStorage.setItem(this.STORAGE_KEYS.REGISTROS_PONTO,JSON.stringify([])),!localStorage.getItem(this.STORAGE_KEYS.CONFIGURACOES)){let o={sincronizacaoAutomatica:!0,intervalSincronizacao:3e5,qualidadeFoto:90,precisaoGPS:100};localStorage.setItem(this.STORAGE_KEYS.CONFIGURACOES,JSON.stringify(o))}}salvarRegistroPonto(o){let t=this.obterRegistrosPonto(),i=c(e({},o),{id:this.gerarId(),sincronizado:!1,tentativasSincronizacao:0});return t.push(i),localStorage.setItem(this.STORAGE_KEYS.REGISTROS_PONTO,JSON.stringify(t)),this.tentarSincronizacao(),i.id}obterRegistrosPonto(){let o=localStorage.getItem(this.STORAGE_KEYS.REGISTROS_PONTO);return o?JSON.parse(o):[]}obterRegistrosNaoSincronizados(){return this.obterRegistrosPonto().filter(o=>!o.sincronizado)}marcarComoSincronizado(o){let t=this.obterRegistrosPonto(),i=t.findIndex(a=>a.id===o);i!==-1&&(t[i].sincronizado=!0,localStorage.setItem(this.STORAGE_KEYS.REGISTROS_PONTO,JSON.stringify(t)))}incrementarTentativaSincronizacao(o){let t=this.obterRegistrosPonto(),i=t.findIndex(a=>a.id===o);i!==-1&&(t[i].tentativasSincronizacao++,localStorage.setItem(this.STORAGE_KEYS.REGISTROS_PONTO,JSON.stringify(t)))}tentarSincronizacao(){return n(this,null,function*(){if(!navigator.onLine){console.log("Dispositivo offline. Sincroniza\xE7\xE3o adiada.");return}let o=this.obterRegistrosNaoSincronizados();for(let t of o)try{yield this.sincronizarRegistro(t),this.marcarComoSincronizado(t.id),console.log(`Registro ${t.id} sincronizado com sucesso`)}catch(i){console.error(`Erro ao sincronizar registro ${t.id}:`,i),this.incrementarTentativaSincronizacao(t.id),t.tentativasSincronizacao>=5&&console.warn(`Registro ${t.id} excedeu limite de tentativas`)}})}sincronizarRegistro(o){return n(this,null,function*(){return new Promise((t,i)=>{setTimeout(()=>{Math.random()>.2?t():i(new Error("Falha na sincroniza\xE7\xE3o simulada"))},1e3)})})}obterConfiguracoes(){let o=localStorage.getItem(this.STORAGE_KEYS.CONFIGURACOES);return o?JSON.parse(o):{}}salvarConfiguracoes(o){localStorage.setItem(this.STORAGE_KEYS.CONFIGURACOES,JSON.stringify(o))}salvarDadosUsuario(o){localStorage.setItem(this.STORAGE_KEYS.USUARIO,JSON.stringify(o))}obterDadosUsuario(){let o=localStorage.getItem(this.STORAGE_KEYS.USUARIO);return o?JSON.parse(o):null}gerarId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}obterEstatisticasSincronizacao(){let o=this.obterRegistrosPonto(),t=o.length,i=o.filter(g=>g.sincronizado).length,a=t-i;return{total:t,sincronizados:i,pendentes:a,percentualSincronizado:t>0?i/t*100:0}}limparDados(){Object.values(this.STORAGE_KEYS).forEach(o=>{localStorage.removeItem(o)}),this.inicializarArmazenamento()}exportarDados(){let o={registros:this.obterRegistrosPonto(),configuracoes:this.obterConfiguracoes(),usuario:this.obterDadosUsuario(),dataExportacao:new Date().toISOString()};return JSON.stringify(o,null,2)}};r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=S({token:r,factory:r.\u0275fac,providedIn:"root"});let s=r;return s})();export{l as a};
